{
      "name": "customerIncident",
      "version": "1.0.1",
      "script": "var db = options.globalSettings.mongodb;\nvar token = options.globalSettings.mongoKey;\n\n\nvar rawId, allData;\ntry{\n    rawId = waylayUtil.getRawData(options, options.requiredProperties.customerID, \"customerID\");\n    allData = waylayUtil.getRawData(options, options.requiredProperties.customerID);\n} catch (err){\n    console.log(\"customer ID not in the raw data\");  \n}\n\nvar customer = rawId || options.requiredProperties.customerID || options.task.RESOURCE;\n\n\nvar data = {\n    resource: options.task.RESOURCE,\n    name : \"Incident\",\n    customerID: customer,\n    customerData: allData,\n    time: new Date()\n}\n\nif(customer){\n  var url = \"https://api.mongolab.com/api/1/databases/\" + db + \"/collections/\"+ \"CRM_RECORD_\"+ options.task.TASK_ID +\"?apiKey=\"+token;\n  var options = {\n    url: url,\n    json: data\n  };\n  var callback = function(error, response, body) {\n    if (!error && response.statusCode == 200) {\n      console.log(body);\n      send();\n    }else{\n      send(new Error(\"Calling mongolab failed: \" + error + \" \" + body));\n    }\n  };\n  request.post(options, callback);\n}else{\n  send(new Error(\"Missing properties\"));\n}",
      "metadata": {
        "author": "",
        "category": "Demo",
        "description": "CustomerIncident actuator",
        "documentationURL": "",
        "iconURL": "http://www.gogadgetpros.com/wp-content/uploads/2013/07/Repair-Icon-180x180.jpg",
        "supportedStates": [],
        "requiredProperties": [
          "customerID"
        ],
        "requiredRawData": []
      }
    }
