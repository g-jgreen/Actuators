{
    "name": "waylayCloudCacheStore",
    "version": "1.1.4",
    "type": "actuator",
    "script": "var resource  = options.requiredProperties.resource || options.node.RESOURCE || options.node.NAME;\n\nvar username =  options.globalSettings.API_KEY;\nvar password = options.globalSettings.API_PASS;\nvar domain = options.requiredProperties.domain;\nvar payload = options.requiredProperties.payload;\n\nvar msg;\n\nif(payload && domain){\n    try{\n       msg = waylayUtil.evaluateData(options, payload);    \n       if (typeof msg === 'string') {\n           console.log(\"trying to parse to JSON\");\n            msg = JSON.parse(msg);\n        }\n        console.log(\"Parsed using eval\");\n        console.log(msg);\n    } catch(err){\n        console.log(\"eval failed with \" + err);\n        console.log(\"trying using raw data\");\n        msg = waylayUtil.getRawData(options, payload);\n    } \n} else {\n    try {\n        msg = waylayUtil.getRawData(options, resource);\n    } catch(err){\n        console.log(\"trying raw data with a resource: \" + resource);\n    }\n}\n\n\n\nif(resource  !== undefined && msg !== undefined){\n  var url = \"https://data.waylay.io/resources/\"+ resource +\"?domain=\"+domain;\n  var options = {\n    url: url,\n    json: msg,\n    auth: {\n        user: username,\n        pass: password,\n        sendImmediately: true\n    }\n  };\n  var callback = function(error, response, body) {\n    if (!error && response.statusCode == 200) {\n      send();\n    }else{\n      console.log(body);\n      send(new Error(\"DATA BRIDGE Failed: \" + error + \" \" + body));\n    }\n  };\n  request.post(options, callback);\n}else{\n  send(new Error(\"Missing properties: [payload and domain]\"));\n}",
    "metadata": {
        "author": "",
        "category": "Waylay",
        "description": "waylayCloudCacheStore will store the payload in the the waylay cloud cache using the broker.\n\nActuator will post a payload using the resource as the identifier.\nInput parameters are:\n<ul>\n<li>domain (must be provided)</li>\n<li>resource, if not provided it will use as the resouece the node's resource name OR the name of the node</li>\n<li>payload (must be provided), which will be pre-processed with  waylayUtil.evaluateData or if not provided, will use the raw data of the item</li>\n</ul>\n\nNote that the broker <strong>will not only store the data, but will also forward (back) the resource and the payload as the stream data to the platform. </strong>\nThat way you can for instance use pull sensor to inject data to all other tasks via the stream data interface. \nFor more info, please check the documentation on the waylay broker and cloud cache.\n\n\n",
        "documentationURL": "",
        "iconURL": "https://raw.githubusercontent.com/waylayio/documentation/master/icons/persisted_cache.png",
        "supportedStates": [],
        "requiredProperties": [
            "domain",
            "resource",
            "payload"
        ],
        "requiredRawData": []
    }
}
